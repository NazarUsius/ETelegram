{% extends 'base/_base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—ñ–ª–∫–∏ -->
  <div class="text-center mb-5">
    <div class="bg-success text-white py-3 rounded-3">
      <h2 class="fw-bold display-4 mb-2">
        –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≥—ñ–ª–∫—É
      </h2>
    </div>
  </div>

  <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≥—ñ–ª–∫—É -->
  <div class="d-flex bg-white rounded-3 shadow-sm p-3 mb-4">
    <img src="{{ data.branch.media.url }}" alt="Branch Media"
         class="img-fluid rounded shadow"
         style="width: 400px; object-fit: cover;">

    <div class="ms-3 flex-grow-1">
      <div class="mb-3 p-3 bg-light rounded">
        <h5 class="text-primary fw-semibold">–ù–∞–∑–≤–∞ –≥—ñ–ª–∫–∏</h5>
        <p class="text-dark mb-0">{{ data.branch.title }}</p>
      </div>
      <div class="mb-3 p-3 bg-light rounded">
        <h5 class="text-primary fw-semibold">–û–ø–∏—Å</h5>
        <p class="text-dark mb-0">{{ data.branch.description }}</p>
      </div>
      <div class="p-3 bg-light rounded">
        <h5 class="text-primary fw-semibold">–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</h5>
        <p class="text-dark mb-0">{{ data.branch.created_at }}</p>
      </div>
    </div>
  </div>

  <hr class="my-4">

  <!-- –û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è -->
  <div class="mb-4">
    <div class="p-3 text-primary-emphasis bg-success-subtle border border-primary-subtle rounded-3 mb-3">
      –û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –Ω–∞ –≥—ñ–ª—Ü—ñ "{{ data.branch.title }}"
    </div>

    <div class="border rounded p-3 bg-light mb-3">
      {% if data.comments %}
        {% for comment_data in data.comments %}
          <div class="d-flex mb-3 {% if comment_data.comment.user == request.user %}justify-content-end{% else %}justify-content-start{% endif %}">
            {% if comment_data.comment.user != request.user %}
              <img src="{{ comment_data.comment.user.avatar.url }}" class="rounded-circle me-2" width="45" height="45" alt="avatar">
            {% endif %}
            <div class="p-3 rounded shadow-sm"
                 style="background-color: {% if comment_data.comment.user == request.user %}#d1e7dd{% else %}#ffffff{% endif %}; max-width: 70%;">
              <p class="mb-1 fw-semibold">{{ comment_data.comment.user.username }}</p>
              <p class="mb-1">{{ comment_data.comment.description }}</p>
              <div class="d-flex justify-content-between align-items-center text-muted small">
                <span><i class="bi bi-clock me-1"></i>{{ comment_data.comment.created_at }}</span>

              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-center text-muted">–ü–æ—á–∞—Ç–∏ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è üí§</p>
      {% endif %}
    </div>

    <!-- –§–æ—Ä–º–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—è -->
    <form method="POST" action="{% url 'comment_create' data.branch.pk %}"
          class="bg-white shadow-sm rounded-pill px-3 py-2 d-flex align-items-center mb-3">
      {% csrf_token %}
      <div class="flex-grow-1 me-2">{{ form.description }}</div>
      <button type="submit"
              class="btn btn-primary d-flex justify-content-center align-items-center"
              style="width:48px; height:48px; border-radius:50%;">
        <i class="bi bi-send-fill"></i>
      </button>
    </form>

    <!-- –í–∏–¥–∞–ª–µ–Ω–Ω—è –≥—ñ–ª–∫–∏ -->
    <form method="post" action="{% url 'branch_delete' data.branch.pk %}" class="text-center">
      {% csrf_token %}
      <button type="submit" class="btn btn-outline-danger rounded-pill px-4">
        <i class="bi bi-trash3-fill"></i> –í–∏–¥–∞–ª–∏—Ç–∏ –≥—ñ–ª–∫—É
      </button>
    </form>
  </div>
</div>

{% endblock %}
