{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Forum</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        body {
            background-color: #f8f9fa;
        }

        .fade-in-card {
            animation: fadeInUp 0.5s ease-in-out;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .fade-in-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .card-text {
            font-size: 1rem;
            color: #444;
        }

        .accordion-button::after {
            transition: transform 0.3s ease;
        }

        .accordion-button.collapsed::after {
            transform: rotate(0deg);
        }

        .accordion-button:not(.collapsed)::after {
            transform: rotate(180deg);
        }

        .btn-outline-primary {
            transition: background-color 0.2s, color 0.2s;
        }

        .btn-outline-primary:hover {
            background-color: #0d6efd;
            color: #fff;
        }

        .badge {
            font-size: 0.85rem;
        }

        .alert-info h4 {
            margin: 0;
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <h1 class="mb-5 text-center display-5 fw-bold text-primary">Forum Branches</h1>

    {% for data in branch_data %}
        <div class="card mb-4 shadow-sm fade-in-card border-0">
            <div class="card-body">
                <h3 class="card-title">{{ data.branch.title }}</h3>
                <p class="card-text">{{ data.branch.description }}</p>

                {% if data.branch.media %}
                    <img src="{{ data.branch.media.url }}" alt="{{ data.branch.title }}"
                         class="img-fluid rounded mb-3 border" style="max-height: 300px; object-fit: cover;">
                {% endif %}

                <p class="text-muted"><small>Posted on {{ data.branch.created_at }}</small></p>

                <div class="d-flex justify-content-start gap-3 mb-3">
                    <span class="badge bg-success">üëç {{ data.likes }}</span>
                    <span class="badge bg-danger">üëé {{ data.dislikes }}</span>
                </div>

                <a href="{% url 'branch_detail' data.branch.pk %}" class="btn btn-outline-primary btn-sm">View Details</a>

                <div class="accordion mt-4" id="accordion-{{ forloop.counter }}">
                    <div class="accordion-item border-0">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed bg-light" type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#comments-{{ forloop.counter }}"
                                    aria-expanded="false">
                                üí¨ Comments
                            </button>
                        </h2>
                        <div id="comments-{{ forloop.counter }}" class="accordion-collapse collapse">
                            <div class="accordion-body">
                                {% if data.comments %}
                                    {% for comment_data in data.comments %}
                                        <div class="border-start ps-3 mb-3">
                                            <p><strong>{{ comment_data.comment.user.username }}</strong>: {{ comment_data.comment.description }}</p>
                                            <p class="text-muted"><small>Posted on {{ comment_data.comment.created_at }}</small></p>
                                            <div class="d-flex gap-3">
                                                <span class="badge bg-primary">üëç {{ comment_data.like_count }}</span>
                                                <span class="badge bg-secondary">üëé {{ comment_data.dislike_count }}</span>
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">No comments yet.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    {% empty %}
        <div class="alert alert-info text-center animate__animated animate__fadeIn">
            <h4>üòï No posts available</h4>
        </div>
    {% endfor %}
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
